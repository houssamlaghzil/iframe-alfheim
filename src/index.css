@import "tailwindcss";

/* ===== Thème clair (tokens) ===== */
@theme {
    --font-sans: "Inter", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";

    --color-bg: #ffffff;          /* fond global */
    --color-surface: #ffffff;     /* cartes / inputs */
    --color-surface-2: #f8fafc;   /* panneaux secondaires */
    --color-border: #e5e7eb;      /* gray-200 */
    --color-muted: #6b7280;       /* gray-500 */

    --color-primary: #6e59ff;     /* violet */
    --color-primary-600: #5b4bff;
    --color-primary-500: #7c6dff;
    --color-accent: #38bdf8;      /* sky */
}

/* ===== Base (forcer clair + texte foncé) ===== */
@layer base {
    :root { color-scheme: light; }
    html, body {
        background: var(--color-bg) !important;
        color: #111827 !important; /* gray-900 */
        font-family: var(--font-sans);
    }
    ::selection { @apply bg-violet-500/20 text-black; }
    a { @apply transition-colors; color: var(--color-primary); }
    a:hover { color: var(--color-accent); }
}

/* ===== Composants ===== */
@layer components {
    /* Boutons — CONTRASTE FORT + texte foncé forcé */
    .btn-primary {
        @apply inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg
        bg-violet-200 hover:bg-violet-300 font-semibold border border-violet-300
        shadow-[0_8px_20px_-12px_rgba(109,40,217,0.25)] transition-all active:scale-[0.98]
        focus:outline-none focus:ring-2 focus:ring-[--color-primary] focus:ring-offset-2;
        color: #111827 !important;
    }
    .btn-primary svg { stroke: currentColor; fill: none; }

    .btn-ghost {
        @apply inline-flex items-center justify-center gap-2 px-3 py-2 rounded-lg
        bg-black/5 hover:bg-black/10 border border-[--color-border] transition-colors;
        color: #111827 !important;
    }

    /* Inputs */
    .input {
        @apply w-full rounded-lg px-3 py-2 bg-[--color-surface] border border-[--color-border]
        text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[--color-primary] focus:border-transparent;
    }

    /* Surfaces */
    .glass { @apply bg-white/85 backdrop-blur-md border border-[--color-border]; }

    .card { @apply rounded-2xl bg-white border border-[--color-border]
    shadow-[0_8px_30px_-18px_rgba(0,0,0,0.12)] overflow-hidden transition-all; }

    .overlay-gradient { @apply absolute inset-0 bg-gradient-to-t from-black/10 via-transparent to-transparent; }

    /* Bulles de chat — TEXTE NOIR (on ne @apply plus .bubble nulle part) */
    .bubble { @apply max-w-[80%] whitespace-pre-wrap rounded-2xl px-3 py-2 text-sm; }

    .bubble-user {
        @apply max-w-[80%] whitespace-pre-wrap rounded-2xl px-3 py-2 text-sm
        bg-violet-100 border border-violet-200;
        color: #000 !important;
    }
    .bubble-user * { color: #000 !important; }

    .bubble-ai {
        @apply max-w-[80%] whitespace-pre-wrap rounded-2xl px-3 py-2 text-sm
        bg-gray-100 border border-[--color-border];
        color: #000 !important;
    }
    .bubble-ai * { color: #000 !important; }

    /* Popup POI claire */
    .poi-popup {
        @apply relative w-64 bg-white text-gray-900 p-4 rounded-xl shadow-xl space-y-3 border border-[--color-border];
    }

    /* ⚠️ Remplacement de `@apply input text-sm` par les utilitaires équivalents */
    .poi-popup .input {
        @apply w-full rounded-lg px-3 py-2 bg-[--color-surface] border border-[--color-border]
        text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[--color-primary] focus:border-transparent text-sm;
    }
}

/* ===== Utilitaires ===== */
@layer utilities {
    .page { padding-top: calc(4rem + env(safe-area-inset-top)); }
    .hover-zoom { @apply transition-transform duration-300 will-change-transform group-hover:scale-[1.03]; }
    .brand-gradient-text { @apply bg-gradient-to-r from-[--color-primary] to-[--color-accent] bg-clip-text text-transparent; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 300ms ease-out both; }

    @keyframes typing { 0%{opacity:.2} 50%{opacity:1} 100%{opacity:.2} }
    .dot { animation: typing 1s infinite; }
}

/* ===== Variables globales pour le layout chat/toolbar ===== */
:root{
    --chat-width: 0px;         /* largeur du chat sur desktop (sinon 0) */
    --chat-open: 0;            /* 0/1 */
    --chat-is-overlay: 0;      /* 0/1 quand le chat est en overlay (mobile) */
    --chat-drawer-width: 0px;  /* largeur du drawer mobile (souvent ~100vw) */
}

/* ===== Toolbar éditeur : position overlay bas-droite sans chevauchement =====
   - Desktop (≥1024px) : on pousse la toolbar à gauche du chat via --chat-width
   - Mobile (<1024px) : bottom-right par défaut; si le chat est un overlay ouvert,
     on bascule à gauche (pour qu’elle reste visible). */
.editor-toolbar{
    position: absolute;
    z-index: 25;            /* au-dessus du Canvas/POIs ; inférieur à des modals */
    pointer-events: none;   /* les clics ne traversent que le conteneur interne */
}
.editor-toolbar > *{ pointer-events: auto; } /* réactiver les clics sur le contenu */

/* Desktop */
@media (min-width: 1024px){
    .editor-toolbar{
        right: calc(var(--chat-width, 0px) + 16px);
        bottom: 16px;
    }
}

/* Mobile / tablette */
@media (max-width: 1023.98px){
    .editor-toolbar{
        right: 16px;
        bottom: calc(env(safe-area-inset-bottom, 0px) + 16px);
    }

    /* Quand le chat overlay est ouvert, on déplace la toolbar sur la gauche.
       On utilise des classes posées par ChatSidebar sur <body>. */
    body.chat-open.chat-overlay .editor-toolbar{
        left: 16px;
        right: auto;
    }
}
